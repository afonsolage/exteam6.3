; Listing generated by Microsoft (R) Optimizing Compiler Version 16.00.40219.01 

	TITLE	D:\Projects\ExTeam6.3\Source\GameServer\GameServer\CustomNpc.cpp
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?gCustomNpc@@3VcCustomNpc@@A			; gCustomNpc
_BSS	SEGMENT
?gCustomNpc@@3VcCustomNpc@@A DB 0198H DUP (?)		; gCustomNpc
_BSS	ENDS
PUBLIC	??_H@YGXPAXIHP6EPAX0@Z@Z			; `vector constructor iterator'
; Function compile flags: /Odtp /ZI
;	COMDAT ??_H@YGXPAXIHP6EPAX0@Z@Z
_TEXT	SEGMENT
___t$ = 8						; size = 4
___s$ = 12						; size = 4
___n$ = 16						; size = 4
___f$ = 20						; size = 4
??_H@YGXPAXIHP6EPAX0@Z@Z PROC				; `vector constructor iterator', COMDAT
  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi
$LN2@vector:
  00009	8b 45 10	 mov	 eax, DWORD PTR ___n$[ebp]
  0000c	83 e8 01	 sub	 eax, 1
  0000f	89 45 10	 mov	 DWORD PTR ___n$[ebp], eax
  00012	78 11		 js	 SHORT $LN3@vector
  00014	8b 4d 08	 mov	 ecx, DWORD PTR ___t$[ebp]
  00017	ff 55 14	 call	 DWORD PTR ___f$[ebp]
  0001a	8b 45 08	 mov	 eax, DWORD PTR ___t$[ebp]
  0001d	03 45 0c	 add	 eax, DWORD PTR ___s$[ebp]
  00020	89 45 08	 mov	 DWORD PTR ___t$[ebp], eax
  00023	eb e4		 jmp	 SHORT $LN2@vector
$LN3@vector:
  00025	5f		 pop	 edi
  00026	5e		 pop	 esi
  00027	5b		 pop	 ebx
  00028	8b e5		 mov	 esp, ebp
  0002a	5d		 pop	 ebp
  0002b	c2 10 00	 ret	 16			; 00000010H
??_H@YGXPAXIHP6EPAX0@Z@Z ENDP				; `vector constructor iterator'
_TEXT	ENDS
PUBLIC	??_C@_02DPKJAMEF@?$CFd?$AA@			; `string'
PUBLIC	??_C@_0BA@PIOFNAIM@LOAD?5FILE?5ERROR?$AA@	; `string'
PUBLIC	??_C@_01KDCPPGHE@r?$AA@				; `string'
PUBLIC	??_C@_06POMJKEPM@Common?$AA@			; `string'
PUBLIC	??_C@_06CKGENIKG@Enable?$AA@			; `string'
PUBLIC	??_C@_0BN@LOGJONBG@?4?4?2Data?2ExData?2CustomNpc?4ini?$AA@ ; `string'
PUBLIC	__$ArrayPad$
PUBLIC	?Load@cCustomNpc@@QAEXXZ			; cCustomNpc::Load
EXTRN	_fclose:PROC
EXTRN	_sscanf:PROC
EXTRN	?Ex_IsBadFileLine@@YA_NPADAAH@Z:PROC		; Ex_IsBadFileLine
EXTRN	_fgets:PROC
EXTRN	_feof:PROC
EXTRN	__imp__MessageBoxA@16:PROC
EXTRN	_fopen:PROC
EXTRN	__imp__GetPrivateProfileIntA@16:PROC
EXTRN	___security_cookie:DWORD
EXTRN	@__security_check_cookie@4:PROC
;	COMDAT ??_C@_02DPKJAMEF@?$CFd?$AA@
; File d:\projects\exteam6.3\source\gameserver\gameserver\customnpc.cpp
CONST	SEGMENT
??_C@_02DPKJAMEF@?$CFd?$AA@ DB '%d', 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_0BA@PIOFNAIM@LOAD?5FILE?5ERROR?$AA@
CONST	SEGMENT
??_C@_0BA@PIOFNAIM@LOAD?5FILE?5ERROR?$AA@ DB 'LOAD FILE ERROR', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_01KDCPPGHE@r?$AA@
CONST	SEGMENT
??_C@_01KDCPPGHE@r?$AA@ DB 'r', 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_06POMJKEPM@Common?$AA@
CONST	SEGMENT
??_C@_06POMJKEPM@Common?$AA@ DB 'Common', 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_06CKGENIKG@Enable?$AA@
CONST	SEGMENT
??_C@_06CKGENIKG@Enable?$AA@ DB 'Enable', 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_0BN@LOGJONBG@?4?4?2Data?2ExData?2CustomNpc?4ini?$AA@
CONST	SEGMENT
??_C@_0BN@LOGJONBG@?4?4?2Data?2ExData?2CustomNpc?4ini?$AA@ DB '..\Data\Ex'
	DB	'Data\CustomNpc.ini', 00H			; `string'
; Function compile flags: /Odtp /ZI
CONST	ENDS
_TEXT	SEGMENT
_n$218940 = -280					; size = 4
_i$218930 = -276					; size = 4
_Flag$ = -272						; size = 4
_Buff$ = -268						; size = 256
_file$ = -12						; size = 4
_this$ = -8						; size = 4
__$ArrayPad$ = -4					; size = 4
?Load@cCustomNpc@@QAEXXZ PROC				; cCustomNpc::Load
; _this$ = ecx

; 9    : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	81 ec 58 01 00
	00		 sub	 esp, 344		; 00000158H
  00009	a1 00 00 00 00	 mov	 eax, DWORD PTR ___security_cookie
  0000e	33 c5		 xor	 eax, ebp
  00010	89 45 fc	 mov	 DWORD PTR __$ArrayPad$[ebp], eax
  00013	53		 push	 ebx
  00014	56		 push	 esi
  00015	57		 push	 edi
  00016	89 4d f8	 mov	 DWORD PTR _this$[ebp], ecx

; 10   : 	this->Enable = GetPrivateProfileInt("Common","Enable",0,CUSTOM_NPC_DIR);

  00019	68 00 00 00 00	 push	 OFFSET ??_C@_0BN@LOGJONBG@?4?4?2Data?2ExData?2CustomNpc?4ini?$AA@
  0001e	6a 00		 push	 0
  00020	68 00 00 00 00	 push	 OFFSET ??_C@_06CKGENIKG@Enable?$AA@
  00025	68 00 00 00 00	 push	 OFFSET ??_C@_06POMJKEPM@Common?$AA@
  0002a	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GetPrivateProfileIntA@16
  00030	8b 4d f8	 mov	 ecx, DWORD PTR _this$[ebp]
  00033	89 01		 mov	 DWORD PTR [ecx], eax

; 11   : 	
; 12   : 	FILE * file = fopen(CUSTOM_NPC_DIR,"r");

  00035	68 00 00 00 00	 push	 OFFSET ??_C@_01KDCPPGHE@r?$AA@
  0003a	68 00 00 00 00	 push	 OFFSET ??_C@_0BN@LOGJONBG@?4?4?2Data?2ExData?2CustomNpc?4ini?$AA@
  0003f	e8 00 00 00 00	 call	 _fopen
  00044	83 c4 08	 add	 esp, 8
  00047	89 45 f4	 mov	 DWORD PTR _file$[ebp], eax

; 13   : 	if(file == NULL)

  0004a	83 7d f4 00	 cmp	 DWORD PTR _file$[ebp], 0
  0004e	75 1d		 jne	 SHORT $LN9@Load

; 14   : 	{
; 15   : 		MessageBoxA(0,CUSTOM_NPC_DIR,"LOAD FILE ERROR",0);

  00050	6a 00		 push	 0
  00052	68 00 00 00 00	 push	 OFFSET ??_C@_0BA@PIOFNAIM@LOAD?5FILE?5ERROR?$AA@
  00057	68 00 00 00 00	 push	 OFFSET ??_C@_0BN@LOGJONBG@?4?4?2Data?2ExData?2CustomNpc?4ini?$AA@
  0005c	6a 00		 push	 0
  0005e	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__MessageBoxA@16

; 16   : 		this->Enable = false;

  00064	8b 45 f8	 mov	 eax, DWORD PTR _this$[ebp]
  00067	c7 00 00 00 00
	00		 mov	 DWORD PTR [eax], 0
$LN9@Load:

; 17   : 	}
; 18   : 
; 19   : 	char Buff[256];
; 20   : 	int Flag = 0;

  0006d	c7 85 f0 fe ff
	ff 00 00 00 00	 mov	 DWORD PTR _Flag$[ebp], 0

; 21   : 	this->CountNpc = 0;

  00077	8b 45 f8	 mov	 eax, DWORD PTR _this$[ebp]
  0007a	c7 80 94 01 00
	00 00 00 00 00	 mov	 DWORD PTR [eax+404], 0

; 22   : 	for (int i = 0; i < MAX_CUSTOM_NPC; i++)

  00084	c7 85 ec fe ff
	ff 00 00 00 00	 mov	 DWORD PTR _i$218930[ebp], 0
  0008e	eb 0f		 jmp	 SHORT $LN8@Load
$LN7@Load:
  00090	8b 85 ec fe ff
	ff		 mov	 eax, DWORD PTR _i$218930[ebp]
  00096	83 c0 01	 add	 eax, 1
  00099	89 85 ec fe ff
	ff		 mov	 DWORD PTR _i$218930[ebp], eax
$LN8@Load:
  0009f	83 bd ec fe ff
	ff 64		 cmp	 DWORD PTR _i$218930[ebp], 100 ; 00000064H
  000a6	7d 13		 jge	 SHORT $LN5@Load

; 23   : 	{
; 24   : 		this->NpcList[i] = 0;

  000a8	8b 85 ec fe ff
	ff		 mov	 eax, DWORD PTR _i$218930[ebp]
  000ae	8b 4d f8	 mov	 ecx, DWORD PTR _this$[ebp]
  000b1	c7 44 81 04 00
	00 00 00	 mov	 DWORD PTR [ecx+eax*4+4], 0

; 25   : 	}

  000b9	eb d5		 jmp	 SHORT $LN7@Load
$LN5@Load:

; 26   : 	while(!feof(file))

  000bb	8b 45 f4	 mov	 eax, DWORD PTR _file$[ebp]
  000be	50		 push	 eax
  000bf	e8 00 00 00 00	 call	 _feof
  000c4	83 c4 04	 add	 esp, 4
  000c7	85 c0		 test	 eax, eax
  000c9	0f 85 99 00 00
	00		 jne	 $LN4@Load

; 27   : 	{
; 28   : 		fgets(Buff,256,file);

  000cf	8b 45 f4	 mov	 eax, DWORD PTR _file$[ebp]
  000d2	50		 push	 eax
  000d3	68 00 01 00 00	 push	 256			; 00000100H
  000d8	8d 8d f4 fe ff
	ff		 lea	 ecx, DWORD PTR _Buff$[ebp]
  000de	51		 push	 ecx
  000df	e8 00 00 00 00	 call	 _fgets
  000e4	83 c4 0c	 add	 esp, 12			; 0000000cH

; 29   : 		if(Ex_IsBadFileLine(Buff, Flag))

  000e7	8d 85 f0 fe ff
	ff		 lea	 eax, DWORD PTR _Flag$[ebp]
  000ed	50		 push	 eax
  000ee	8d 8d f4 fe ff
	ff		 lea	 ecx, DWORD PTR _Buff$[ebp]
  000f4	51		 push	 ecx
  000f5	e8 00 00 00 00	 call	 ?Ex_IsBadFileLine@@YA_NPADAAH@Z ; Ex_IsBadFileLine
  000fa	83 c4 08	 add	 esp, 8
  000fd	0f b6 d0	 movzx	 edx, al
  00100	85 d2		 test	 edx, edx
  00102	74 02		 je	 SHORT $LN3@Load

; 30   : 			continue;

  00104	eb b5		 jmp	 SHORT $LN5@Load
$LN3@Load:

; 31   : 		if(Flag == 1)

  00106	83 bd f0 fe ff
	ff 01		 cmp	 DWORD PTR _Flag$[ebp], 1
  0010d	75 54		 jne	 SHORT $LN2@Load

; 32   : 		{
; 33   : 			if(this->CountNpc == MAX_CUSTOM_NPC) break;

  0010f	8b 45 f8	 mov	 eax, DWORD PTR _this$[ebp]
  00112	83 b8 94 01 00
	00 64		 cmp	 DWORD PTR [eax+404], 100 ; 00000064H
  00119	75 02		 jne	 SHORT $LN1@Load
  0011b	eb 4b		 jmp	 SHORT $LN4@Load
$LN1@Load:

; 34   : 			int n[1];
; 35   : 			sscanf(Buff, "%d", &n[0]);

  0011d	8d 85 e8 fe ff
	ff		 lea	 eax, DWORD PTR _n$218940[ebp]
  00123	50		 push	 eax
  00124	68 00 00 00 00	 push	 OFFSET ??_C@_02DPKJAMEF@?$CFd?$AA@
  00129	8d 8d f4 fe ff
	ff		 lea	 ecx, DWORD PTR _Buff$[ebp]
  0012f	51		 push	 ecx
  00130	e8 00 00 00 00	 call	 _sscanf
  00135	83 c4 0c	 add	 esp, 12			; 0000000cH

; 36   : 			this->NpcList[this->CountNpc] = n[0];

  00138	8b 45 f8	 mov	 eax, DWORD PTR _this$[ebp]
  0013b	8b 88 94 01 00
	00		 mov	 ecx, DWORD PTR [eax+404]
  00141	8b 55 f8	 mov	 edx, DWORD PTR _this$[ebp]
  00144	8b 85 e8 fe ff
	ff		 mov	 eax, DWORD PTR _n$218940[ebp]
  0014a	89 44 8a 04	 mov	 DWORD PTR [edx+ecx*4+4], eax

; 37   : 			this->CountNpc++;

  0014e	8b 45 f8	 mov	 eax, DWORD PTR _this$[ebp]
  00151	8b 88 94 01 00
	00		 mov	 ecx, DWORD PTR [eax+404]
  00157	83 c1 01	 add	 ecx, 1
  0015a	8b 55 f8	 mov	 edx, DWORD PTR _this$[ebp]
  0015d	89 8a 94 01 00
	00		 mov	 DWORD PTR [edx+404], ecx
$LN2@Load:

; 38   : 		}
; 39   : 	}

  00163	e9 53 ff ff ff	 jmp	 $LN5@Load
$LN4@Load:

; 40   : 	fclose(file);

  00168	8b 45 f4	 mov	 eax, DWORD PTR _file$[ebp]
  0016b	50		 push	 eax
  0016c	e8 00 00 00 00	 call	 _fclose
  00171	83 c4 04	 add	 esp, 4

; 41   : }

  00174	5f		 pop	 edi
  00175	5e		 pop	 esi
  00176	5b		 pop	 ebx
  00177	8b 4d fc	 mov	 ecx, DWORD PTR __$ArrayPad$[ebp]
  0017a	33 cd		 xor	 ecx, ebp
  0017c	e8 00 00 00 00	 call	 @__security_check_cookie@4
  00181	8b e5		 mov	 esp, ebp
  00183	5d		 pop	 ebp
  00184	c3		 ret	 0
?Load@cCustomNpc@@QAEXXZ ENDP				; cCustomNpc::Load
_TEXT	ENDS
PUBLIC	?Main@cCustomNpc@@QAEXHH@Z			; cCustomNpc::Main
EXTRN	?gObj@@3PAUOBJECTSTRUCT@@A:DWORD		; gObj
; Function compile flags: /Odtp /ZI
_TEXT	SEGMENT
_i$218948 = -12						; size = 4
_lpObj$ = -8						; size = 4
_this$ = -4						; size = 4
_aIndex$ = 8						; size = 4
_MonsterClass$ = 12					; size = 4
?Main@cCustomNpc@@QAEXHH@Z PROC				; cCustomNpc::Main
; _this$ = ecx

; 44   : {

  00190	55		 push	 ebp
  00191	8b ec		 mov	 ebp, esp
  00193	83 ec 4c	 sub	 esp, 76			; 0000004cH
  00196	53		 push	 ebx
  00197	56		 push	 esi
  00198	57		 push	 edi
  00199	89 4d fc	 mov	 DWORD PTR _this$[ebp], ecx

; 45   : 	if(!this->Enable)return;

  0019c	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  0019f	83 38 00	 cmp	 DWORD PTR [eax], 0
  001a2	75 02		 jne	 SHORT $LN5@Main
  001a4	eb 4f		 jmp	 SHORT $LN6@Main
$LN5@Main:

; 46   :  	LPOBJ lpObj = &gObj[aIndex];

  001a6	8b 45 08	 mov	 eax, DWORD PTR _aIndex$[ebp]
  001a9	69 c0 38 2b 00
	00		 imul	 eax, 11064		; 00002b38H
  001af	03 05 00 00 00
	00		 add	 eax, DWORD PTR ?gObj@@3PAUOBJECTSTRUCT@@A ; gObj
  001b5	89 45 f8	 mov	 DWORD PTR _lpObj$[ebp], eax

; 47   : 	for (int i = 0; i < this->CountNpc; i++)

  001b8	c7 45 f4 00 00
	00 00		 mov	 DWORD PTR _i$218948[ebp], 0
  001bf	eb 09		 jmp	 SHORT $LN4@Main
$LN3@Main:
  001c1	8b 45 f4	 mov	 eax, DWORD PTR _i$218948[ebp]
  001c4	83 c0 01	 add	 eax, 1
  001c7	89 45 f4	 mov	 DWORD PTR _i$218948[ebp], eax
$LN4@Main:
  001ca	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  001cd	8b 4d f4	 mov	 ecx, DWORD PTR _i$218948[ebp]
  001d0	3b 88 94 01 00
	00		 cmp	 ecx, DWORD PTR [eax+404]
  001d6	7d 1d		 jge	 SHORT $LN6@Main

; 48   : 		if(MonsterClass == NpcList[i])

  001d8	8b 45 f4	 mov	 eax, DWORD PTR _i$218948[ebp]
  001db	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  001de	8b 55 0c	 mov	 edx, DWORD PTR _MonsterClass$[ebp]
  001e1	3b 54 81 04	 cmp	 edx, DWORD PTR [ecx+eax*4+4]
  001e5	75 0c		 jne	 SHORT $LN1@Main

; 49   : 			lpObj->Type = OBJ_NPC;

  001e7	b8 03 00 00 00	 mov	 eax, 3
  001ec	8b 4d f8	 mov	 ecx, DWORD PTR _lpObj$[ebp]
  001ef	66 89 41 68	 mov	 WORD PTR [ecx+104], ax
$LN1@Main:

; 50   : }

  001f3	eb cc		 jmp	 SHORT $LN3@Main
$LN6@Main:
  001f5	5f		 pop	 edi
  001f6	5e		 pop	 esi
  001f7	5b		 pop	 ebx
  001f8	8b e5		 mov	 esp, ebp
  001fa	5d		 pop	 ebp
  001fb	c2 08 00	 ret	 8
?Main@cCustomNpc@@QAEXHH@Z ENDP				; cCustomNpc::Main
_TEXT	ENDS
END
