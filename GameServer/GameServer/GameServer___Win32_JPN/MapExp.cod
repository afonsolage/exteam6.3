; Listing generated by Microsoft (R) Optimizing Compiler Version 16.00.40219.01 

	TITLE	D:\Projects\ExTeam6.3\Source\GameServer\GameServer\MapExp.cpp
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?gMapExp@@3VcMapExp@@A				; gMapExp
_BSS	SEGMENT
?gMapExp@@3VcMapExp@@A DB 02d8H DUP (?)			; gMapExp
_BSS	ENDS
PUBLIC	??_H@YGXPAXIHP6EPAX0@Z@Z			; `vector constructor iterator'
; Function compile flags: /Odtp /ZI
;	COMDAT ??_H@YGXPAXIHP6EPAX0@Z@Z
_TEXT	SEGMENT
___t$ = 8						; size = 4
___s$ = 12						; size = 4
___n$ = 16						; size = 4
___f$ = 20						; size = 4
??_H@YGXPAXIHP6EPAX0@Z@Z PROC				; `vector constructor iterator', COMDAT
  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi
$LN2@vector:
  00009	8b 45 10	 mov	 eax, DWORD PTR ___n$[ebp]
  0000c	83 e8 01	 sub	 eax, 1
  0000f	89 45 10	 mov	 DWORD PTR ___n$[ebp], eax
  00012	78 11		 js	 SHORT $LN3@vector
  00014	8b 4d 08	 mov	 ecx, DWORD PTR ___t$[ebp]
  00017	ff 55 14	 call	 DWORD PTR ___f$[ebp]
  0001a	8b 45 08	 mov	 eax, DWORD PTR ___t$[ebp]
  0001d	03 45 0c	 add	 eax, DWORD PTR ___s$[ebp]
  00020	89 45 08	 mov	 DWORD PTR ___t$[ebp], eax
  00023	eb e4		 jmp	 SHORT $LN2@vector
$LN3@vector:
  00025	5f		 pop	 edi
  00026	5e		 pop	 esi
  00027	5b		 pop	 ebx
  00028	8b e5		 mov	 esp, ebp
  0002a	5d		 pop	 ebp
  0002b	c2 10 00	 ret	 16			; 00000010H
??_H@YGXPAXIHP6EPAX0@Z@Z ENDP				; `vector constructor iterator'
_TEXT	ENDS
PUBLIC	??_C@_05OKMLJOMC@?$CFd?5?$CFd?$AA@		; `string'
PUBLIC	??_C@_0BA@PIOFNAIM@LOAD?5FILE?5ERROR?$AA@	; `string'
PUBLIC	??_C@_01KDCPPGHE@r?$AA@				; `string'
PUBLIC	??_C@_06POMJKEPM@Common?$AA@			; `string'
PUBLIC	??_C@_06CKGENIKG@Enable?$AA@			; `string'
PUBLIC	??_C@_0BK@FCGNKMJJ@?4?4?2Data?2ExData?2MapExp?4ini?$AA@ ; `string'
PUBLIC	__$ArrayPad$
PUBLIC	?LoadConfig@cMapExp@@QAEXXZ			; cMapExp::LoadConfig
EXTRN	_fclose:PROC
EXTRN	_sscanf:PROC
EXTRN	?Ex_IsBadFileLine@@YA_NPADAAH@Z:PROC		; Ex_IsBadFileLine
EXTRN	_fgets:PROC
EXTRN	_feof:PROC
EXTRN	__imp__MessageBoxA@16:PROC
EXTRN	_fopen:PROC
EXTRN	__imp__GetPrivateProfileIntA@16:PROC
EXTRN	___security_cookie:DWORD
EXTRN	@__security_check_cookie@4:PROC
;	COMDAT ??_C@_05OKMLJOMC@?$CFd?5?$CFd?$AA@
; File d:\projects\exteam6.3\source\gameserver\gameserver\mapexp.cpp
CONST	SEGMENT
??_C@_05OKMLJOMC@?$CFd?5?$CFd?$AA@ DB '%d %d', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0BA@PIOFNAIM@LOAD?5FILE?5ERROR?$AA@
CONST	SEGMENT
??_C@_0BA@PIOFNAIM@LOAD?5FILE?5ERROR?$AA@ DB 'LOAD FILE ERROR', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_01KDCPPGHE@r?$AA@
CONST	SEGMENT
??_C@_01KDCPPGHE@r?$AA@ DB 'r', 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_06POMJKEPM@Common?$AA@
CONST	SEGMENT
??_C@_06POMJKEPM@Common?$AA@ DB 'Common', 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_06CKGENIKG@Enable?$AA@
CONST	SEGMENT
??_C@_06CKGENIKG@Enable?$AA@ DB 'Enable', 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_0BK@FCGNKMJJ@?4?4?2Data?2ExData?2MapExp?4ini?$AA@
CONST	SEGMENT
??_C@_0BK@FCGNKMJJ@?4?4?2Data?2ExData?2MapExp?4ini?$AA@ DB '..\Data\ExDat'
	DB	'a\MapExp.ini', 00H				; `string'
; Function compile flags: /Odtp /ZI
CONST	ENDS
_TEXT	SEGMENT
_n$218948 = -284					; size = 8
_Flag$ = -276						; size = 4
_Buff$ = -272						; size = 256
_file$ = -16						; size = 4
_i$218932 = -12						; size = 4
_this$ = -8						; size = 4
__$ArrayPad$ = -4					; size = 4
?LoadConfig@cMapExp@@QAEXXZ PROC			; cMapExp::LoadConfig
; _this$ = ecx

; 10   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	81 ec 5c 01 00
	00		 sub	 esp, 348		; 0000015cH
  00009	a1 00 00 00 00	 mov	 eax, DWORD PTR ___security_cookie
  0000e	33 c5		 xor	 eax, ebp
  00010	89 45 fc	 mov	 DWORD PTR __$ArrayPad$[ebp], eax
  00013	53		 push	 ebx
  00014	56		 push	 esi
  00015	57		 push	 edi
  00016	89 4d f8	 mov	 DWORD PTR _this$[ebp], ecx

; 11   : 	this->Enable = GetPrivateProfileInt("Common","Enable",0,MAP_EXP_DIR);

  00019	68 00 00 00 00	 push	 OFFSET ??_C@_0BK@FCGNKMJJ@?4?4?2Data?2ExData?2MapExp?4ini?$AA@
  0001e	6a 00		 push	 0
  00020	68 00 00 00 00	 push	 OFFSET ??_C@_06CKGENIKG@Enable?$AA@
  00025	68 00 00 00 00	 push	 OFFSET ??_C@_06POMJKEPM@Common?$AA@
  0002a	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GetPrivateProfileIntA@16
  00030	8b 4d f8	 mov	 ecx, DWORD PTR _this$[ebp]
  00033	89 01		 mov	 DWORD PTR [ecx], eax

; 12   : 	for(int i(0);i<MAX_NUMBER_MAP;i++)

  00035	c7 45 f4 00 00
	00 00		 mov	 DWORD PTR _i$218932[ebp], 0
  0003c	eb 09		 jmp	 SHORT $LN9@LoadConfig
$LN8@LoadConfig:
  0003e	8b 45 f4	 mov	 eax, DWORD PTR _i$218932[ebp]
  00041	83 c0 01	 add	 eax, 1
  00044	89 45 f4	 mov	 DWORD PTR _i$218932[ebp], eax
$LN9@LoadConfig:
  00047	83 7d f4 5a	 cmp	 DWORD PTR _i$218932[ebp], 90 ; 0000005aH
  0004b	7d 1e		 jge	 SHORT $LN7@LoadConfig

; 13   : 	{
; 14   : 		this->Number[i].Map = 0;

  0004d	8b 45 f4	 mov	 eax, DWORD PTR _i$218932[ebp]
  00050	8b 4d f8	 mov	 ecx, DWORD PTR _this$[ebp]
  00053	c7 44 c1 04 00
	00 00 00	 mov	 DWORD PTR [ecx+eax*8+4], 0

; 15   : 		this->Number[i].Exp = 0;

  0005b	8b 45 f4	 mov	 eax, DWORD PTR _i$218932[ebp]
  0005e	8b 4d f8	 mov	 ecx, DWORD PTR _this$[ebp]
  00061	c7 44 c1 08 00
	00 00 00	 mov	 DWORD PTR [ecx+eax*8+8], 0

; 16   : 	}

  00069	eb d3		 jmp	 SHORT $LN8@LoadConfig
$LN7@LoadConfig:

; 17   : 	FILE * file = fopen(MAP_EXP_DIR,"r");

  0006b	68 00 00 00 00	 push	 OFFSET ??_C@_01KDCPPGHE@r?$AA@
  00070	68 00 00 00 00	 push	 OFFSET ??_C@_0BK@FCGNKMJJ@?4?4?2Data?2ExData?2MapExp?4ini?$AA@
  00075	e8 00 00 00 00	 call	 _fopen
  0007a	83 c4 08	 add	 esp, 8
  0007d	89 45 f0	 mov	 DWORD PTR _file$[ebp], eax

; 18   : 	if(file == NULL)

  00080	83 7d f0 00	 cmp	 DWORD PTR _file$[ebp], 0
  00084	75 1d		 jne	 SHORT $LN6@LoadConfig

; 19   : 	{
; 20   : 		MessageBoxA(0,MAP_EXP_DIR,"LOAD FILE ERROR",0);

  00086	6a 00		 push	 0
  00088	68 00 00 00 00	 push	 OFFSET ??_C@_0BA@PIOFNAIM@LOAD?5FILE?5ERROR?$AA@
  0008d	68 00 00 00 00	 push	 OFFSET ??_C@_0BK@FCGNKMJJ@?4?4?2Data?2ExData?2MapExp?4ini?$AA@
  00092	6a 00		 push	 0
  00094	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__MessageBoxA@16

; 21   : 		this->Enable = false;

  0009a	8b 45 f8	 mov	 eax, DWORD PTR _this$[ebp]
  0009d	c7 00 00 00 00
	00		 mov	 DWORD PTR [eax], 0
$LN6@LoadConfig:

; 22   : 	}
; 23   : 	if(!this->Enable)return;

  000a3	8b 45 f8	 mov	 eax, DWORD PTR _this$[ebp]
  000a6	83 38 00	 cmp	 DWORD PTR [eax], 0
  000a9	75 05		 jne	 SHORT $LN5@LoadConfig
  000ab	e9 df 00 00 00	 jmp	 $LN10@LoadConfig
$LN5@LoadConfig:

; 24   : 
; 25   : 	char Buff[256];
; 26   : 	int Flag = 0;

  000b0	c7 85 ec fe ff
	ff 00 00 00 00	 mov	 DWORD PTR _Flag$[ebp], 0

; 27   : 	this->rCount = 0;

  000ba	8b 45 f8	 mov	 eax, DWORD PTR _this$[ebp]
  000bd	c7 80 d4 02 00
	00 00 00 00 00	 mov	 DWORD PTR [eax+724], 0
$LN4@LoadConfig:

; 28   : 
; 29   : 	while(!feof(file)) // Проверяем есть ли строка в документе

  000c7	8b 45 f0	 mov	 eax, DWORD PTR _file$[ebp]
  000ca	50		 push	 eax
  000cb	e8 00 00 00 00	 call	 _feof
  000d0	83 c4 04	 add	 esp, 4
  000d3	85 c0		 test	 eax, eax
  000d5	0f 85 a8 00 00
	00		 jne	 $LN3@LoadConfig

; 30   : 	{
; 31   : 		fgets(Buff,256,file);//Функция читает текущую строку

  000db	8b 45 f0	 mov	 eax, DWORD PTR _file$[ebp]
  000de	50		 push	 eax
  000df	68 00 01 00 00	 push	 256			; 00000100H
  000e4	8d 8d f0 fe ff
	ff		 lea	 ecx, DWORD PTR _Buff$[ebp]
  000ea	51		 push	 ecx
  000eb	e8 00 00 00 00	 call	 _fgets
  000f0	83 c4 0c	 add	 esp, 12			; 0000000cH

; 32   : 		if(Ex_IsBadFileLine(Buff, Flag)) //Вспомогательная функция

  000f3	8d 85 ec fe ff
	ff		 lea	 eax, DWORD PTR _Flag$[ebp]
  000f9	50		 push	 eax
  000fa	8d 8d f0 fe ff
	ff		 lea	 ecx, DWORD PTR _Buff$[ebp]
  00100	51		 push	 ecx
  00101	e8 00 00 00 00	 call	 ?Ex_IsBadFileLine@@YA_NPADAAH@Z ; Ex_IsBadFileLine
  00106	83 c4 08	 add	 esp, 8
  00109	0f b6 d0	 movzx	 edx, al
  0010c	85 d2		 test	 edx, edx
  0010e	74 02		 je	 SHORT $LN2@LoadConfig

; 33   : 			continue;

  00110	eb b5		 jmp	 SHORT $LN4@LoadConfig
$LN2@LoadConfig:

; 34   : 		if(Flag == 1)

  00112	83 bd ec fe ff
	ff 01		 cmp	 DWORD PTR _Flag$[ebp], 1
  00119	75 63		 jne	 SHORT $LN1@LoadConfig

; 35   : 		{
; 36   : 			int n[2];
; 37   : 			sscanf(Buff, "%d %d", &n[0], &n[1]);

  0011b	8d 85 e8 fe ff
	ff		 lea	 eax, DWORD PTR _n$218948[ebp+4]
  00121	50		 push	 eax
  00122	8d 8d e4 fe ff
	ff		 lea	 ecx, DWORD PTR _n$218948[ebp]
  00128	51		 push	 ecx
  00129	68 00 00 00 00	 push	 OFFSET ??_C@_05OKMLJOMC@?$CFd?5?$CFd?$AA@
  0012e	8d 95 f0 fe ff
	ff		 lea	 edx, DWORD PTR _Buff$[ebp]
  00134	52		 push	 edx
  00135	e8 00 00 00 00	 call	 _sscanf
  0013a	83 c4 10	 add	 esp, 16			; 00000010H

; 38   : 			this->Number[this->rCount].Map = n[0];

  0013d	8b 45 f8	 mov	 eax, DWORD PTR _this$[ebp]
  00140	8b 88 d4 02 00
	00		 mov	 ecx, DWORD PTR [eax+724]
  00146	8b 55 f8	 mov	 edx, DWORD PTR _this$[ebp]
  00149	8b 85 e4 fe ff
	ff		 mov	 eax, DWORD PTR _n$218948[ebp]
  0014f	89 44 ca 04	 mov	 DWORD PTR [edx+ecx*8+4], eax

; 39   : 			this->Number[this->rCount].Exp = n[1];

  00153	8b 45 f8	 mov	 eax, DWORD PTR _this$[ebp]
  00156	8b 88 d4 02 00
	00		 mov	 ecx, DWORD PTR [eax+724]
  0015c	8b 55 f8	 mov	 edx, DWORD PTR _this$[ebp]
  0015f	8b 85 e8 fe ff
	ff		 mov	 eax, DWORD PTR _n$218948[ebp+4]
  00165	89 44 ca 08	 mov	 DWORD PTR [edx+ecx*8+8], eax

; 40   : 			this->rCount++;

  00169	8b 45 f8	 mov	 eax, DWORD PTR _this$[ebp]
  0016c	8b 88 d4 02 00
	00		 mov	 ecx, DWORD PTR [eax+724]
  00172	83 c1 01	 add	 ecx, 1
  00175	8b 55 f8	 mov	 edx, DWORD PTR _this$[ebp]
  00178	89 8a d4 02 00
	00		 mov	 DWORD PTR [edx+724], ecx
$LN1@LoadConfig:

; 41   : 		}
; 42   : 	}

  0017e	e9 44 ff ff ff	 jmp	 $LN4@LoadConfig
$LN3@LoadConfig:

; 43   : 	fclose(file);

  00183	8b 45 f0	 mov	 eax, DWORD PTR _file$[ebp]
  00186	50		 push	 eax
  00187	e8 00 00 00 00	 call	 _fclose
  0018c	83 c4 04	 add	 esp, 4
$LN10@LoadConfig:

; 44   : }

  0018f	5f		 pop	 edi
  00190	5e		 pop	 esi
  00191	5b		 pop	 ebx
  00192	8b 4d fc	 mov	 ecx, DWORD PTR __$ArrayPad$[ebp]
  00195	33 cd		 xor	 ecx, ebp
  00197	e8 00 00 00 00	 call	 @__security_check_cookie@4
  0019c	8b e5		 mov	 esp, ebp
  0019e	5d		 pop	 ebp
  0019f	c3		 ret	 0
?LoadConfig@cMapExp@@QAEXXZ ENDP			; cMapExp::LoadConfig
_TEXT	ENDS
PUBLIC	?Main@cMapExp@@QAEXPAUOBJECTSTRUCT@@AA_J@Z	; cMapExp::Main
EXTRN	__alldiv:PROC
EXTRN	__allmul:PROC
; Function compile flags: /Odtp /ZI
_TEXT	SEGMENT
_i$218958 = -20						; size = 4
_NewExp$ = -16						; size = 8
_aIndex$ = -8						; size = 4
_this$ = -4						; size = 4
_lpObj$ = 8						; size = 4
_Experience$ = 12					; size = 4
?Main@cMapExp@@QAEXPAUOBJECTSTRUCT@@AA_J@Z PROC		; cMapExp::Main
; _this$ = ecx

; 47   : {

  001a0	55		 push	 ebp
  001a1	8b ec		 mov	 ebp, esp
  001a3	83 ec 54	 sub	 esp, 84			; 00000054H
  001a6	53		 push	 ebx
  001a7	56		 push	 esi
  001a8	57		 push	 edi
  001a9	89 4d fc	 mov	 DWORD PTR _this$[ebp], ecx

; 48   : 	if(!this->Enable) return;

  001ac	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  001af	83 38 00	 cmp	 DWORD PTR [eax], 0
  001b2	75 05		 jne	 SHORT $LN5@Main
  001b4	e9 89 00 00 00	 jmp	 $LN6@Main
$LN5@Main:

; 49   : 	int aIndex = lpObj->m_Index;

  001b9	8b 45 08	 mov	 eax, DWORD PTR _lpObj$[ebp]
  001bc	8b 08		 mov	 ecx, DWORD PTR [eax]
  001be	89 4d f8	 mov	 DWORD PTR _aIndex$[ebp], ecx

; 50   : 	__int64 NewExp = Experience;

  001c1	8b 45 0c	 mov	 eax, DWORD PTR _Experience$[ebp]
  001c4	8b 08		 mov	 ecx, DWORD PTR [eax]
  001c6	89 4d f0	 mov	 DWORD PTR _NewExp$[ebp], ecx
  001c9	8b 50 04	 mov	 edx, DWORD PTR [eax+4]
  001cc	89 55 f4	 mov	 DWORD PTR _NewExp$[ebp+4], edx

; 51   : 	for(int i=0;i<this->rCount;i++)

  001cf	c7 45 ec 00 00
	00 00		 mov	 DWORD PTR _i$218958[ebp], 0
  001d6	eb 09		 jmp	 SHORT $LN4@Main
$LN3@Main:
  001d8	8b 45 ec	 mov	 eax, DWORD PTR _i$218958[ebp]
  001db	83 c0 01	 add	 eax, 1
  001de	89 45 ec	 mov	 DWORD PTR _i$218958[ebp], eax
$LN4@Main:
  001e1	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  001e4	8b 4d ec	 mov	 ecx, DWORD PTR _i$218958[ebp]
  001e7	3b 88 d4 02 00
	00		 cmp	 ecx, DWORD PTR [eax+724]
  001ed	7d 45		 jge	 SHORT $LN2@Main

; 52   : 	{
; 53   : 		if(this->Number[i].Map == lpObj->MapNumber)

  001ef	8b 45 08	 mov	 eax, DWORD PTR _lpObj$[ebp]
  001f2	0f b6 88 49 01
	00 00		 movzx	 ecx, BYTE PTR [eax+329]
  001f9	8b 55 ec	 mov	 edx, DWORD PTR _i$218958[ebp]
  001fc	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  001ff	39 4c d0 04	 cmp	 DWORD PTR [eax+edx*8+4], ecx
  00203	75 2d		 jne	 SHORT $LN1@Main

; 54   : 		{
; 55   : 			NewExp = (( NewExp * this->Number[i].Exp ) / 100 );

  00205	8b 45 ec	 mov	 eax, DWORD PTR _i$218958[ebp]
  00208	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  0020b	8b 44 c1 08	 mov	 eax, DWORD PTR [ecx+eax*8+8]
  0020f	99		 cdq
  00210	52		 push	 edx
  00211	50		 push	 eax
  00212	8b 55 f4	 mov	 edx, DWORD PTR _NewExp$[ebp+4]
  00215	52		 push	 edx
  00216	8b 45 f0	 mov	 eax, DWORD PTR _NewExp$[ebp]
  00219	50		 push	 eax
  0021a	e8 00 00 00 00	 call	 __allmul
  0021f	6a 00		 push	 0
  00221	6a 64		 push	 100			; 00000064H
  00223	52		 push	 edx
  00224	50		 push	 eax
  00225	e8 00 00 00 00	 call	 __alldiv
  0022a	89 45 f0	 mov	 DWORD PTR _NewExp$[ebp], eax
  0022d	89 55 f4	 mov	 DWORD PTR _NewExp$[ebp+4], edx

; 56   : 			break;

  00230	eb 02		 jmp	 SHORT $LN2@Main
$LN1@Main:

; 57   : 		}
; 58   : 	}

  00232	eb a4		 jmp	 SHORT $LN3@Main
$LN2@Main:

; 59   : 	Experience = NewExp;

  00234	8b 45 0c	 mov	 eax, DWORD PTR _Experience$[ebp]
  00237	8b 4d f0	 mov	 ecx, DWORD PTR _NewExp$[ebp]
  0023a	89 08		 mov	 DWORD PTR [eax], ecx
  0023c	8b 55 f4	 mov	 edx, DWORD PTR _NewExp$[ebp+4]
  0023f	89 50 04	 mov	 DWORD PTR [eax+4], edx
$LN6@Main:

; 60   : }

  00242	5f		 pop	 edi
  00243	5e		 pop	 esi
  00244	5b		 pop	 ebx
  00245	8b e5		 mov	 esp, ebp
  00247	5d		 pop	 ebp
  00248	c2 08 00	 ret	 8
?Main@cMapExp@@QAEXPAUOBJECTSTRUCT@@AA_J@Z ENDP		; cMapExp::Main
_TEXT	ENDS
END
